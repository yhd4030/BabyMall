<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>商品列表</title>
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}">
    <link rel="stylesheet" th:href="@{/layui/css/dropdown.css}">
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/indexCss.css}">
    <link rel="stylesheet" th:href="@{/css/bs.css}">
    <link rel="stylesheet" th:href="@{/css/jquery-confirm.css}">
    <link rel="stylesheet" th:href="@{/css/mc-dialoger.css}"/>

    <script th:src="@{/js/jquery-3.4.1.min.js}" type="application/javascript"></script>
    <script th:src="@{/js/bootstrap.min.js}" type="text/javascript"></script>
    <script th:src="@{/js/domlastic.js}" type="text/javascript"></script>
    <script th:src="@{/js/distpicker/distpicker.data.js}" type="application/javascript"></script>
    <script th:src="@{/js/distpicker/distpicker.js}" type="application/javascript"></script>
    <script th:src="@{/js/distpicker/main.js}" type="application/javascript"></script>
    <script th:src="@{/js/jquery-confirm.js}" type="text/javascript"></script>
    <script th:src="@{/js/validate/jquery.validate.js}" type="text/javascript"></script>
    <script type="text/javascript" th:src="@{/js/dialoger.js}"></script>

    <style type="text/css">
        td {
            max-width: 100px;
            overflow: hidden;
        }

        #searchBook {
            padding-top: 50px;
        }
    </style>

    <script type="text/javascript">

        function editBook(pId) {
            location.href = "/admin/product/edit?pId=" + pId;
        }

        function changeBookShelf(pid, isShelf) {
            var $btnId = $("#shelfBtn" + pid);
            var $stateId = $("#state" + pid);
            var idStr = "shelfBtn" + pid;
            var stateId = "state" + pid;
            if (isShelf == 0) {
                if (confirm("上架书籍?")) {
                    let isShelf = 1;
                    $.ajax({
                        method: "post",
                        url: "/admin/product/updateIsShelf",
                        data: {id: pid, isShelf: isShelf},
                        success: function (data) {
                            if (data == true) {
                                dialoger.$toast({mes: '上架成功', timeout: 1000});
                                $($stateId).slideToggle(500, function () {
                                    // $($btnId).innerHTML="<td class='red' id='"+stateId+"'>已上架</td>"
                                    $($stateId).replaceWith("<td class='green' id='" + stateId + "'>已上架</td>");
                                });
                                $($btnId).slideToggle(150, function () {
                                    $($btnId).replaceWith(" <button id='" + idStr + "' type='button' class='btn btn-xs btn-warning'  text='下架'" +
                                        "onclick='changeBookShelf(" + pid + "," + isShelf + ")'>下架</button>");
                                });
                            }
                        }
                    });
                }
            }
            if (isShelf == 1) {
                if (confirm("下架书籍?")) {
                    let isShelf = 0;
                    $.ajax({
                        method: "post",
                        url: "/admin/product/updateIsShelf",
                        data: {id: pid, isShelf: isShelf},
                        success: function (data) {
                            if (data == true) {
                                dialoger.$toast({mes: '已下架'})
                                $($stateId).slideToggle(500, function () {
                                    // $($stateId).innerHTML="<td class='red' id='"+stateId+"'>已上架</td>";
                                    $($stateId).replaceWith("<td class='red' id='" + stateId + "'>已下架</td>");
                                });
                                $($btnId).slideToggle(150, function () {
                                    $($btnId).replaceWith(" <button id='" + idStr + "' type='button' class='btn btn-xs btn-warning'  text='上架'" +
                                        "onclick='changeBookShelf(" + pid + "," + isShelf + ")'>上架</button>");
                                });
                            }
                        }
                    });
                }
            }
        }

        function deleteBook(bookId) {
            if (confirm("删除这本书?")) {
                location.href = "<%=basePath%>admin/book/deletion/" + bookId + "?keywords=" + '${keywords}';
            }
        }

    </script>
</head>
<body>
<div class="container" style="border: 1px solid #CCCCCC;">
    <div id="searchBook" style="height:100px;border-bottom: 1px solid #CCCCCC;">
        <form action="admin/book/list" class="form-inline" role="form" method="get">
            <div class="form-group">
                <input type="text" class="form-control" id="name" name="keywords" value="${keywords}"
                       placeholder="商品名称">
            </div>

            <button type="submit" class="btn btn-default" onchange="adasd()">
                <span class="glyphicon glyphicon-search"></span> 商品搜索
            </button>
        </form>
    </div>

    <table class="table table-hover">
        <caption>书籍列表</caption>
        <thead>
        <tr>
            <th>序号</th>
            <th>商品名称</th>
            <th>图片</th>
            <th>种类</th>
            <th>现价</th>
            <th>折扣</th>
            <th>原价</th>
            <th>状态</th>
            <th>库存</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <!--        <c:forEach items="${bookPageInfo.list}" var="book" varStatus="vs">-->
        <tr th:each="product:${productList.list}">
            <td th:text="${product.id}"></td>
            <td>
                <a th:href="'/product/info/'+${product.id}" target="_blank" th:title="${product.productName}">
                    <span class="admin_productName" th:text="${product.productName}"
                          style="white-space: nowrap; text-overflow: ellipsis; overflow: hidden; width: 120px; display: inline-block;"></span>
                </a>
            </td>
            <td>
                <img th:src="${product.productImg}" style="width: 50%">
            </td>
            <td th:text="${product.typeId}"></td>
            <td class="red" th:text="'￥'+${product.price}"></td>
            <td class="red" th:text="${product.discount}"></td>
            <td class="red" th:text="${product.price.multiply(product.discount).setScale(2)}"></td>
            <td th:class="${product.isShelf}==1?'green':'red'" th:id="'state'+${product.id}"
                th:text="${product.isShelf}==1?'上架中':'已下架'"></td>
            <td th:text="${product.amount}"></td>
            <td>
                <button type="button" class="btn btn-xs btn-info" th:onclick="|editBook(${product.id})|">
                    <span class="glyphicon glyphicon-pencil"></span> 编辑
                </button>
                <button th:id="'shelfBtn'+${product.id}" type="button" class="btn btn-xs btn-warning"
                        th:text="${product.isShelf}==1?'下架':'上架'"
                        th:onclick="|changeBookShelf(${product.id},${product.isShelf})|"></button>
                <button type="button" class="btn btn-xs btn-danger" onclick="deleteBook(${book.bookId})">
                    <span class="glyphicon glyphicon-pencil"></span> 删除
                </button>
            </td>
        </tr>
        <!--        </c:forEach>-->
        </tbody>
    </table>
    <nav aria-label="Page navigation" style="text-align: center">
        <ul class="pagination">
            <li th:if="${productList.hasPreviousPage}">
                <a th:href="'?pageNum=1'" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li th:if="${productList.hasPreviousPage}"><a th:href="'?pageNum='+${productList.prePage}"><</a></li>
            <li th:each="nav : ${productList.navigatepageNums}">
                <a th:href="'?pageNum='+${nav}" th:text="${nav}"
                   th:if="${nav != productList.pageNum}">
                </a>
                <span style="font-weight: bold" th:if="${nav == productList.pageNum}" th:text="${nav}"></span>
            </li>
            <li th:if="${productList.hasNextPage}">
                <a th:href="'?pageNum='+${productList.nextPage}">
                    >
                </a>
            </li>
            <li th:if="${productList.hasNextPage}">
                <a th:href="'?pageNum='+${productList.pages}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>
</div>

</body>
</html>